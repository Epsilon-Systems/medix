jQuery(document).ready(function(jQuery){$=jQuery;var queue=[].map(function(script){return"js"===script.slice(-2)&&0===jQuery("script[src*='"+script.slice(-30)+"']").length?jQuery("head").append('<script type="text/javascript" src="'+script+'"><\/script>'):"css"===script.slice(-3)&&0===jQuery("link[href*='"+script.slice(-30)+"']").length?jQuery("head").append('<link rel="stylesheet" href="'+script+'"/>'):void 0});jQuery.when.apply(null,queue).done(function(){var nTimer;nTimer=setInterval(function(){void 0!=jQuery().confirm&&(clearInterval(nTimer),nobossapiconnection.CONSTRUCTOR())},50)})});var nobossapiconnection={CONSTRUCTOR:function(){jQuery(".nobossapiconnection").each(function(idx,elem){var api=jQuery(elem).attr("data-api");void 0!==api&&nobossapiconnection.setValidAccessToken(api)}),jQuery("body").on("click","[data-id=noboss-modal]",function(){setTimeout(function(){var api=jQuery(".noboss-modal:not(.hidden)").find("[data-api]").attr("data-api");void 0!==api&&nobossapiconnection.setValidAccessToken(api)},2e3)}),jQuery("body").on("click",'[data-id="api-btn-connect"]',function(){var api=jQuery(this).closest("[data-api]").attr("data-api"),urlRedirect=jQuery(this).closest("[data-api]").attr("data-api-redirect");switch(api){case"googlecalendar":case"youtube":case"vimeo":case"facebook":nobossapiconnection.startApiAuth(api,urlRedirect)}})},startApiAuth:function(api,urlRedirect){var clientId=jQuery('[data-api="'+api+'"]').find('[data-id="client_id"]').val(),clientSecret=jQuery('[data-api="'+api+'"]').find('[data-id="client_secret"]').val();window.open(urlRedirect+"&client_id="+clientId+"&client_secret="+clientSecret+"&lang="+sefLanguage,"_blank")},saveApiToken:function(tokenValues,api){var clientId=jQuery('[data-api="'+api+'"]').find('[data-id="client_id"]').val(),clientSecret=jQuery('[data-api="'+api+'"]').find('[data-id="client_secret"]').val(),value=JSON.stringify({client_id:clientId,client_secret:clientSecret,access_token:tokenValues.access_token,refresh_token:tokenValues.refresh_token});jQuery('[data-api="'+api+'"]').find('[data-id="apiconnection_hidden"]').val(value),nobossapiconnection.updateStatus(api,"1","")},setValidAccessToken:function(api){var apiConnection=jQuery('[data-api="'+api+'"]').find('[data-id="apiconnection_hidden"]').val();if(""!=apiConnection&&void 0!=apiConnection)if(""!=(apiConnection=JSON.parse(apiConnection)).client_id&&""!=apiConnection.client_secret){0==jQuery("div.loader--fullpage").length&&(jQuery(".noboss-modal").append('<div class="loader loader--fullpage"></div>'),jQuery(".noboss-modal").append('<div class="loader-fade"></div>'));var request={option:"com_nobossajax",library:"noboss.forms.fields.nobossapiconnection.nobossapiconnectionhelper",method:"getValidAccessToken",format:"raw"},data={client_id:apiConnection.client_id,client_secret:apiConnection.client_secret,access_token:apiConnection.access_token,refresh_token:apiConnection.refresh_token,api:api};setTimeout(function(){jQuery.ajax({url:baseNameUrl+"administrator/index.php?"+jQuery.param(request),type:"POST",dataType:"JSON",async:!1,data:data,error:function(jqXHR,textStatus,errorThrown){throw new nobossapiconnection.updateStatus(api,"-1",errorThrown)}}).done(function(result){if(void 0!==result.success&&1===result.success){if(1==result.status&&""!=result.new_access_token){var apiConnection=JSON.parse(jQuery('[data-api="'+api+'"]').find('[data-id="apiconnection_hidden"]').val());apiConnection.access_token=result.new_access_token,apiConnection=JSON.stringify(apiConnection),jQuery('[data-api="'+api+'"]').find('[data-id="apiconnection_hidden"]').val(apiConnection)}nobossapiconnection.updateStatus(api,result.status,"")}else nobossapiconnection.updateStatus(api,result.status,result.message);jQuery(".noboss-modal").find(".loader.loader--fullpage").remove(),jQuery(".noboss-modal").find(".loader-fade").remove()})})}else nobossapiconnection.updateStatus(api,"0","");else nobossapiconnection.updateStatus(api,"0","")},updateStatus:function(api,status,extraMessage){var elementStatus=jQuery('[data-api="'+api+'"]').find("[data-api-status]");elementStatus.attr("data-api-status",status).trigger("change");var msg="";switch(status){case"1":msg='<span class="badge badge-success bg-success">Connected</span>';break;case"0":msg='<span class="badge badge-warning bg-warning">Not connected</span>';break;case"-1":msg='<span class="badge badge-danger bg-danger">Error</span>'}""!=extraMessage&&(msg=msg+" | "+extraMessage),elementStatus.find("[data-api-status-text]").html(msg)}};