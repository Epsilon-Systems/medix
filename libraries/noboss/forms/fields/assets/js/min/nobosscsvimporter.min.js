jQuery(document).ready(function(jQuery){$=jQuery;var queue=[baseNameUrl+"libraries/noboss/assets/util/js/min/loaders.min.js","https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.0/jquery-confirm.min.js",baseNameUrl+"libraries/noboss/assets/plugins/stylesheets/css/jquery-confirm.min.css"].map(function(script){return"js"===script.slice(-2)&&0===jQuery("script[src*='"+script.slice(-30)+"']").length?jQuery("head").append('<script type="text/javascript" src="'+script+'"><\/script>'):"css"===script.slice(-3)&&0===jQuery("link[href*='"+script.slice(-30)+"']").length?jQuery("head").append('<link rel="stylesheet" href="'+script+'"/>'):void 0});jQuery.when.apply(null,queue).done(function(){var nTimer;nTimer=setInterval(function(){void 0!=jQuery().confirm&&(clearInterval(nTimer),nobossCsvImporter.CONSTRUCTOR())},50)})});var nobossCsvImporter={CONSTRUCTOR:function(){$(".csvimportercols-btn-upload").on("click",function(event){event.preventDefault(),$('[data-csvimporter="file"]').trigger("click")}),$('[data-csvimporter="file"]').bind("change",nobossCsvImporter.fileUpload),$('[data-id="download-csv"]').on("click",nobossCsvImporter.fileDownload),nobossCsvImporter.dataMigrationInLoadMode()},fileDownload:function(evt){var csvContent="",header=jQuery('[data-csvimporter="file"]').data("csvimportercols");if(jQuery.each(header,function(key,value){csvContent+=decodeURI(value.label)+";"}),csvContent+="\n",jQuery('[data-csvimporter="jsonvalue"]').val().length>0){var data=JSON.parse(jQuery('[data-csvimporter="jsonvalue"]').val());jQuery.each(data,function(i,itemValues){jQuery.each(header,function(key,value){void 0==itemValues[value.alias]?csvContent+=";":csvContent+=decodeURI(itemValues[value.alias])+";"}),csvContent+="\n"})}else console.log("Nenhum dado encontrado para baixar na planilha. Será gerado download da planilha apenas com cabeçalho");var pom=document.createElement("a"),blob=new Blob(["\ufeff"+csvContent],{type:"text/csv;charset=utf-8;"}),url=URL.createObjectURL(blob);pom.href=url,pom.setAttribute("download","data.csv"),pom.click()},fileUpload:function(evt){nobossCsvImporter.error=!1;var msgError="";if(void 0!=typeof evt.target.value&&""!==evt.target.value)if(/.+(.csv|.txt)$/.test(evt.target.value.toLowerCase())){var file=evt.target.files[0],reader=new FileReader;reader.readAsText(file,"ISO-8859-1"),reader.onload=function(event){util.addLoader();var cols=jQuery(evt.target).data("csvimportercols"),allTextLines=event.target.result.split(/\r\n|\n/),data=[],tableOld=jQuery("#csvimporter-result").html();document.getElementById("csvimporter-result").textContent="";for(var tableImport=document.getElementById("csvimporter-result"),tableImportRow=tableImport.appendChild(document.createElement("thead")).appendChild(document.createElement("tr")),k=0;k<cols.length;k++)tableImportRow.appendChild(document.createElement("th")).appendChild(document.createTextNode(cols[k].label));for(var i=1;i<allTextLines.length;i++)if(void 0!==allTextLines[i]&&""!=allTextLines[i]&&allTextLines[i].length>cols.length){var lineData=allTextLines[i].split(";"),line={};tableImportRow=tableImport.appendChild(document.createElement("tr"));for(var j=0;j<cols.length;j++)if(void 0!==lineData[j]&&""!=lineData[j]){if(line[cols[j].alias]=lineData[j].trim().toString(),line[cols[j].alias]=line[cols[j].alias].replace(/""/g,'"'),line[cols[j].alias]=line[cols[j].alias].replace(/^"/g,""),line[cols[j].alias]=line[cols[j].alias].replace(/"$/g,""),line[cols[j].alias]=line[cols[j].alias].replace(/"/g,"'"),void 0!=cols[j].validvalues&&""!=cols[j].validvalues){validOptions=cols[j].validvalues.split("|");var returnValidOptions=nobossCsvImporter.columnValidOptions(cols[j],i,line[cols[j].alias],validOptions);if(void 0==returnValidOptions.success||0==returnValidOptions.success){nobossCsvImporter.error=!0,msgError=returnValidOptions.message,jQuery("#csvimporter-result").html(tableOld);break}}if(void 0!=cols[j].jsfunction&&""!=cols[j].jsfunction&&"function"==typeof window[cols[j].jsfunction]){var returnTreatment=window[cols[j].jsfunction](cols[j],line[cols[j].alias],i);if("object"!=typeof returnTreatment)console.log(Joomla.JText._("LIB_NOBOSS_FIELD_NOBOSSCSVIMPORTER_BADLY_FORMATTED_FUNCTION").replace("%s1",cols[j].label).replace("%s2",cols[j].jsfunction));else if(void 0!=returnTreatment.success&&1==returnTreatment.success&&void 0!=returnTreatment.value)line[cols[j].alias]=returnTreatment.value;else if(void 0!=returnTreatment.message){nobossCsvImporter.error=!0,msgError=returnTreatment.message,jQuery("#csvimporter-result").html(tableOld);break}}tableImportRow.appendChild(document.createElement("td")).appendChild(document.createTextNode(line[cols[j].alias])),line[cols[j].alias]=encodeURI(line[cols[j].alias])}else tableImportRow.appendChild(document.createElement("td")).appendChild(document.createTextNode(""));if(1==nobossCsvImporter.error)break;data[i-1]=line}setTimeout(function(){util.removeLoader()},1e3),1==nobossCsvImporter.error?jQuery.alert({title:Joomla.JText._("LIB_NOBOSS_FIELD_NOBOSSCSVIMPORTER_UNABLE_UPLOAD_DATA_TITLE"),content:msgError,type:"red",buttons:{ok:{keys:["enter"]}}}):(jQuery('[data-csvimporter="jsonvalue"]').val(JSON.stringify(data)),jQuery("#csvimporter-result").parent().show())},reader.onerror=function(){alert(Joomla.JText._("LIB_NOBOSS_FIELD_NOBOSSCSVIMPORTER_ERROR_READING_FILE")+file.fileName)},jQuery(evt.target).val("")}else jQuery.alert({title:Joomla.JText._("LIB_NOBOSS_FIELD_NOBOSSCSVIMPORTER_UNABLE_UPLOAD_DATA_TITLE"),content:"Only .csv and .txt file extensions allowed",type:"red",buttons:{ok:{keys:["enter"]}}})},columnValidOptions:function(colData,line,value,validOptions){if(validOptions.length>0)return validOptions.indexOf(value)>-1?{success:1}:{success:0,message:Joomla.JText._("LIB_NOBOSS_FIELD_NOBOSSCSVIMPORTER_INCORRECTLY_FORMATTED_DATA").replace("%s1",value).replace("%s2",colData.label).replace("%s3",line)+validOptions.join("', '")+"'"}},dataMigrationInLoadMode:function(){jQuery("#itemsloadmode").on("change",function(){var option=jQuery(this).find("option[value="+jQuery(this).val()+"]").val(),data=null,subform="";return void 0!==jQuery('[data-csvimporter="file"]').data("subformname")&&(!((subform=jQuery('input[name$="\\['+jQuery('[data-csvimporter="file"]').data("subformname")+'\\]"]').parent().find(".row-fluid[data-subform-collapse-wrapper]")).length<1)&&(util.addLoader(),setTimeout(function(){if(jQuery("body").append('<div class="loader-message">'+Joomla.JText._("LIB_NOBOSS_FIELD_NOBOSSCSVIMPORTER_DATA_BEING_MIGRATED")+"</div>"),"manual"==option)subform.find(".subform-repeatable-group").remove(),jQuery('[data-csvimporter="jsonvalue"]').val().length>0?(data=JSON.parse(jQuery('[data-csvimporter="jsonvalue"]').val()),jQuery.each(data,function(i,itemValues){var arrayItems=[];jQuery.each(itemValues,function(key,value){arrayItems[key]=decodeURI(value)}),itemValues=null,subform.find(".btn-toolbar .btn-group a.group-add").click();var newItem=subform.find('[data-new="true"]').last();newItem.find("input").not('[type="radio"]').each(function(){void 0!=jQuery(this).attr("name")&&(nameField=jQuery(this).attr("name").match(/jform(\[([a-z0-9_-]*)\])*/)[2],jQuery(this).is(".minicolors")?jQuery(this).minicolors("value",arrayItems[nameField]):jQuery(this).val(arrayItems[nameField]))}),newItem.find("select").each(function(){nameField=jQuery(this).attr("name").match(/jform(\[([a-z0-9_-]*)\])*/)[2],jQuery(this).val(arrayItems[nameField]),void 0!==majorVersionJoomla&&"4"!=majorVersionJoomla&&jQuery(this).trigger("liszt:updated")}),newItem.find("fieldset.radio").each(function(){var inputRadioTarget=jQuery(this).find('label[class*="active"]').first().attr("for"),inputRadioSelected=jQuery(this).find("input#"+inputRadioTarget);if(void 0!=inputRadioSelected.attr("name")){nameField=inputRadioSelected.attr("name").match(/jform(\[([a-z0-9_-]*)\])*/)[2];var tempRadio=newItem.find('input[name$="\\['+nameField+'\\]"][value="'+arrayItems[nameField]+'"]');tempRadio.siblings('label[for="'+tempRadio.attr("id")+'"]').click()}}),newItem.find(".controls > textarea").each(function(){void 0!=jQuery(this).attr("name")&&(nameField=jQuery(this).attr("name").match(/jform(\[([a-z0-9_-]*)\])*/)[2],jQuery(this).val(arrayItems[nameField]))}),newItem.find(".js-editor-tinymce textarea").each(function(){nameField=jQuery(this).attr("name").match(/jform(\[([a-z0-9_-]*)\])*/)[2],jQuery(this).val(arrayItems[nameField]).parent().find("iframe").contents().find("body").html(arrayItems[nameField])})}),nobosssubform.toggleCollapseAll("shrink",subform),jQuery('[data-csvimporter="jsonvalue"]').val(""),document.getElementById("csvimporter-result").textContent=""):console.log("Nenhum dado encontrado para migrar de CSV p/ subform.");else if("csv"==option){var subformItems=subform.find(".subform-repeatable-group[data-base-name]");if(subformItems.length>1||1==subformItems.length&&document.formvalidator.isValid(document.adminForm)){var arrayItems=[];subformItems.each(function(){var arrayFields=[],nameField="";jQuery(this).find("input").not('[type="radio"]').each(function(){void 0!=jQuery(this).attr("name")&&(nameField=jQuery(this).attr("name").match(/jform(\[([a-z0-9_-]*)\])*/)[2],arrayFields[nameField]=jQuery(this).val())}),jQuery(this).find("select").each(function(){void 0!=jQuery(this).attr("name")&&(nameField=jQuery(this).attr("name").match(/jform(\[([a-z0-9_-]*)\])*/)[2],arrayFields[nameField]=jQuery(this).val())}),jQuery(this).find("fieldset.radio").each(function(){var inputRadioTarget=jQuery(this).find('label[class*="active"]').first().attr("for"),inputRadioSelected=jQuery(this).find("input#"+inputRadioTarget);void 0!=inputRadioSelected.attr("name")&&(nameField=inputRadioSelected.attr("name").match(/jform(\[([a-z0-9_-]*)\])*/)[2],arrayFields[nameField]=inputRadioSelected.val())}),jQuery(this).find(".controls > textarea").each(function(){void 0!=jQuery(this).attr("name")&&(nameField=jQuery(this).attr("name").match(/jform(\[([a-z0-9_-]*)\])*/)[2],arrayFields[nameField]=jQuery(this).html())}),jQuery(this).find(".js-editor-tinymce textarea").each(function(){nameField=jQuery(this).attr("name").match(/jform(\[([a-z0-9_-]*)\])*/)[2],arrayFields[nameField]=jQuery(this).parent().find("iframe").contents().find("body").html()}),arrayItems.push(Object.assign({},arrayFields)),jQuery(this).remove()}),jQuery('[data-csvimporter="jsonvalue"]').val(JSON.stringify(arrayItems)),subform.find(".subform-repeatable-group").remove(),document.getElementById("csvimporter-result").textContent=""}}},1e3),void setTimeout(function(){util.removeLoader(),jQuery("body").find(".loader-message").remove(),Joomla.submitbutton("module.apply")},1e3)))})}};